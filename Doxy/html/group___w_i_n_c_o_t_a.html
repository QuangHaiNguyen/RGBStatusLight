<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RGBStatusLight: WINC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RGBStatusLight
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group___w_i_n_c_o_t_a.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">WINC<div class="ingroups"><a class="el" href="group___o_t_a_a_p_i.html">OTA</a> &raquo; <a class="el" href="group___o_t_a_f_u_n_c_t_i_o_n_s.html">Functions</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga347bfe1c0c505f6aa9555efc8b701b0c"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___w_i_n_c_o_t_a.html#ga347bfe1c0c505f6aa9555efc8b701b0c">m2m_ota_notif_set_url</a> (uint8_t *u8Url)</td></tr>
<tr class="memdesc:ga347bfe1c0c505f6aa9555efc8b701b0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the OTA url.  <a href="group___w_i_n_c_o_t_a.html#ga347bfe1c0c505f6aa9555efc8b701b0c">More...</a><br /></td></tr>
<tr class="separator:ga347bfe1c0c505f6aa9555efc8b701b0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab0a3b76022a3606acc2369ad7b1ab9a5"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___w_i_n_c_o_t_a.html#gab0a3b76022a3606acc2369ad7b1ab9a5">m2m_ota_notif_check_for_update</a> (void)</td></tr>
<tr class="memdesc:gab0a3b76022a3606acc2369ad7b1ab9a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">check for OTA update  <a href="group___w_i_n_c_o_t_a.html#gab0a3b76022a3606acc2369ad7b1ab9a5">More...</a><br /></td></tr>
<tr class="separator:gab0a3b76022a3606acc2369ad7b1ab9a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga420f4a1c3f2868bd63c4118f00e55103"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___w_i_n_c_o_t_a.html#ga420f4a1c3f2868bd63c4118f00e55103">m2m_ota_notif_sched</a> (uint32_t u32Period)</td></tr>
<tr class="memdesc:ga420f4a1c3f2868bd63c4118f00e55103"><td class="mdescLeft">&#160;</td><td class="mdescRight">Schedule OTA update.  <a href="group___w_i_n_c_o_t_a.html#ga420f4a1c3f2868bd63c4118f00e55103">More...</a><br /></td></tr>
<tr class="separator:ga420f4a1c3f2868bd63c4118f00e55103"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaefb92e6e53637bd62b8371e7f00dd4eb"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___w_i_n_c_o_t_a.html#gaefb92e6e53637bd62b8371e7f00dd4eb">m2m_ota_start_update</a> (unsigned char *pcDownloadUrl)</td></tr>
<tr class="memdesc:gaefb92e6e53637bd62b8371e7f00dd4eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request OTA start update using the downloaded url.  <a href="group___w_i_n_c_o_t_a.html#gaefb92e6e53637bd62b8371e7f00dd4eb">More...</a><br /></td></tr>
<tr class="separator:gaefb92e6e53637bd62b8371e7f00dd4eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad238a0b0d9218b8db10d82a95fc91dad"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___w_i_n_c_o_t_a.html#gad238a0b0d9218b8db10d82a95fc91dad">m2m_ota_rollback</a> (void)</td></tr>
<tr class="memdesc:gad238a0b0d9218b8db10d82a95fc91dad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request OTA Rollback image.  <a href="group___w_i_n_c_o_t_a.html#gad238a0b0d9218b8db10d82a95fc91dad">More...</a><br /></td></tr>
<tr class="separator:gad238a0b0d9218b8db10d82a95fc91dad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga24e44fbce7ca42ded0e1daa500c40ca8"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a> (void)</td></tr>
<tr class="memdesc:ga24e44fbce7ca42ded0e1daa500c40ca8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Switch to the upgraded Firmware.  <a href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">More...</a><br /></td></tr>
<tr class="separator:ga24e44fbce7ca42ded0e1daa500c40ca8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a id="gab0a3b76022a3606acc2369ad7b1ab9a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab0a3b76022a3606acc2369ad7b1ab9a5">&#9670;&nbsp;</a></span>m2m_ota_notif_check_for_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t m2m_ota_notif_check_for_update </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>check for OTA update </p>
<p>Synchronous function to check for the OTA update using the Notification Server URL.<br  />
 Function is not implemented (not supported at the current version).</p>
<dl class="section return"><dt>Returns</dt><dd>The function SHALL return 0 for success and a negative value otherwise.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Function is not implemented (not supported at the current version).</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39" title="Initialize the OTA layer.">m2m_ota_init</a> <a class="el" href="group___w_i_n_c_o_t_a.html#ga347bfe1c0c505f6aa9555efc8b701b0c" title="Set the OTA url.">m2m_ota_notif_set_url</a></dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns M2M_SUCCESS for successful operations and a negative value otherwise. </dd></dl>

</div>
</div>
<a id="ga420f4a1c3f2868bd63c4118f00e55103"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga420f4a1c3f2868bd63c4118f00e55103">&#9670;&nbsp;</a></span>m2m_ota_notif_sched()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t m2m_ota_notif_sched </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>u32Period</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Schedule OTA update. </p>
<p>Schedule OTA notification Server check for update request after specific number of days.<br  />
 Function is not implemented (not supported at the current version).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">u32Period</td><td>Period in days</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function SHALL return 0 for success and a negative value otherwise.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">u32Period</td><td>Period in days</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>Function is not implemented (not supported at the current version).</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39" title="Initialize the OTA layer.">m2m_ota_init</a> <a class="el" href="group___w_i_n_c_o_t_a.html#gab0a3b76022a3606acc2369ad7b1ab9a5" title="check for OTA update">m2m_ota_notif_check_for_update</a> <a class="el" href="group___w_i_n_c_o_t_a.html#ga347bfe1c0c505f6aa9555efc8b701b0c" title="Set the OTA url.">m2m_ota_notif_set_url</a></dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns M2M_SUCCESS for successful operations and a negative value otherwise. </dd></dl>

</div>
</div>
<a id="ga347bfe1c0c505f6aa9555efc8b701b0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga347bfe1c0c505f6aa9555efc8b701b0c">&#9670;&nbsp;</a></span>m2m_ota_notif_set_url()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t m2m_ota_notif_set_url </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>u8Url</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the OTA url. </p>
<p>Set the OTA notification server URL, the function needs to be called before any check for update.<br  />
 This functionality is not supported by WINC firmware.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">u8Url</td><td>The url server address</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function SHALL return 0 for success and a negative value otherwise.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">u8Url</td><td>Set the OTA notification server URL, the function needs to be called before any check for update.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section pre"><dt>Precondition</dt><dd>Prior calling of <a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39">m2m_ota_init</a> is required.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Notification Server is not supported in the current version (function is not implemented).</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39" title="Initialize the OTA layer.">m2m_ota_init</a></dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns M2M_SUCCESS for successful operations and a negative value otherwise. </dd></dl>

</div>
</div>
<a id="gad238a0b0d9218b8db10d82a95fc91dad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad238a0b0d9218b8db10d82a95fc91dad">&#9670;&nbsp;</a></span>m2m_ota_rollback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t m2m_ota_rollback </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request OTA Rollback image. </p>
<p>Request OTA Roll-back to the old (inactive) WINC image, the WINC firmware will check the validity of the inactive image and activate it if valid. On completion, a callback of type <a class="el" href="group___o_t_a_c_a_l_l_b_a_c_k_s.html#ga320069e48ae34c5bfd5ef5aebaf0269b">tpfOtaUpdateCb</a> is called (application must previously have provided the callback via <a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39">m2m_ota_init</a>). If the callback indicates successful activation, the newly-activated image will start running after next system reset.</p>
<dl class="section return"><dt>Returns</dt><dd>The function SHALL return 0 for success and a negative value otherwise.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>If rollback requires a host driver update in order to maintain HIF compatibility (HIF major value change), then it is recommended to update the host driver prior to calling this API.<br  />
 In the event of system reset with incompatible driver/firmware, compatibility can be recovered by calling <a class="el" href="group___w_i_n_c_o_t_a.html#gad238a0b0d9218b8db10d82a95fc91dad">m2m_ota_rollback</a> or <a class="el" href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a>. See <a class="el" href="group___w_i_n_c_o_t_a.html#OTAExample">Example</a>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39" title="Initialize the OTA layer.">m2m_ota_init</a> <a class="el" href="group___w_i_n_c_o_t_a.html#gaefb92e6e53637bd62b8371e7f00dd4eb" title="Request OTA start update using the downloaded url.">m2m_ota_start_update</a></dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns M2M_SUCCESS for successful operations and a negative value otherwise. </dd></dl>

</div>
</div>
<a id="gaefb92e6e53637bd62b8371e7f00dd4eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaefb92e6e53637bd62b8371e7f00dd4eb">&#9670;&nbsp;</a></span>m2m_ota_start_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t m2m_ota_start_update </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>pcDownloadUrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request OTA start update using the downloaded url. </p>
<p>Request OTA start update using the download URL. The OTA module will download the OTA image, ensure integrity of the image and update the validity of the image in the control structure. On completion, a callback of type <a class="el" href="group___o_t_a_c_a_l_l_b_a_c_k_s.html#ga320069e48ae34c5bfd5ef5aebaf0269b">tpfOtaUpdateCb</a> is called (callback previously provided via <a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39">m2m_ota_init</a>). Switching to the updated image additionally requires completion of <a class="el" href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a>, followed by a WINC reset.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pcDownloadUrl</td><td>The download firmware url, you get it from device info</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function SHALL return 0 for success and a negative value otherwise.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pcDownloadUrl</td><td>The download firmware URL, according to the application server.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>Calling this API does not guarantee OTA WINC image update, it depends on the connection with the download server and the validity of the image.<br  />
 Calling this API invalidates any previous valid rollback image, irrespective of the result, but when the OTA succeeds, the current image will become the rollback image after <a class="el" href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a>.</dd></dl>
<dl class="section pre"><dt>Precondition</dt><dd><a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39">m2m_ota_init</a> is a prerequisite and must have been called before using m2m_ota_start_update.<br  />
 Switching to the newly downloaded image requires calling <a class="el" href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a> API.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39">m2m_ota_init</a> <a class="el" href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a> <a class="el" href="group___o_t_a_c_a_l_l_b_a_c_k_s.html#ga320069e48ae34c5bfd5ef5aebaf0269b">tpfOtaUpdateCb</a></dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns M2M_SUCCESS for successful operations and a negative value otherwise. Note that successful operation in this context means the OTA update request has reached the firmware OTA module. It does not indicate whether or not the image update succeeded.</dd></dl>
<h1><a class="anchor" id="OTAExample"></a>
Example</h1>
<p>This example shows how an OTA image update and switch is carried out. It demonstrates use of the following OTA APIs:</p><ul>
<li><a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39">m2m_ota_init</a></li>
<li><a class="el" href="group___o_t_a_c_a_l_l_b_a_c_k_s.html#ga320069e48ae34c5bfd5ef5aebaf0269b">tpfOtaUpdateCb</a></li>
<li><a class="el" href="group___w_i_n_c_o_t_a.html#gaefb92e6e53637bd62b8371e7f00dd4eb">m2m_ota_start_update</a></li>
<li><a class="el" href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a></li>
<li><a class="el" href="group___w_i_n_c_o_t_a.html#gad238a0b0d9218b8db10d82a95fc91dad">m2m_ota_rollback</a></li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> OtaUpdateCb(uint8_t u8OtaUpdateStatusType, uint8_t u8OtaUpdateStatus)</div>
<div class="line">{</div>
<div class="line">    WINC_LOG_INFO(<span class="stringliteral">&quot;%d %d&quot;</span>, u8OtaUpdateStatusType, u8OtaUpdateStatus);</div>
<div class="line">    <span class="keywordflow">switch</span>(u8OtaUpdateStatusType)</div>
<div class="line">    {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___o_t_a_t_y_p_e_d_e_f.html#gga3e56744d263918b9e36016f78d823c3aa9b634fb58a53969f9af8a89908e58c5e">DL_STATUS</a>:</div>
<div class="line">        <span class="keywordflow">if</span>(u8OtaUpdateStatus == <a class="code" href="group___o_t_a_t_y_p_e_d_e_f.html#ggab7006b9cb55eb414d0416d0513533eeba23e293bcc679d3021e202ac255b71500">OTA_STATUS_SUCCESS</a>)</div>
<div class="line">        {</div>
<div class="line">            WINC_LOG_INFO(<span class="stringliteral">&quot;OTA download succeeded&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// In this case the application MAY WANT TO update the host driver before calling</span></div>
<div class="line">            <span class="comment">// @ref m2m_ota_switch_firmware(). Switching firmware image and resetting without</span></div>
<div class="line">            <span class="comment">// updating host driver may lead to suboptimal functionality.</span></div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Switch to the upgraded firmware</span></div>
<div class="line">            WINC_LOG_INFO(<span class="stringliteral">&quot;Now switching active partition...&quot;</span>);</div>
<div class="line">            <a class="code" href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a>();</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___o_t_a_t_y_p_e_d_e_f.html#gga3e56744d263918b9e36016f78d823c3aa2f1dabb326d861eadb5a5cd1b41962ff">SW_STATUS</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___o_t_a_t_y_p_e_d_e_f.html#gga3e56744d263918b9e36016f78d823c3aad9b2f16f8c41c4108806a4c78dea422c">RB_STATUS</a>:</div>
<div class="line">        <span class="keywordflow">if</span>(u8OtaUpdateStatus == <a class="code" href="group___o_t_a_t_y_p_e_d_e_f.html#ggab7006b9cb55eb414d0416d0513533eeba23e293bcc679d3021e202ac255b71500">OTA_STATUS_SUCCESS</a>)</div>
<div class="line">        {</div>
<div class="line">            WINC_LOG_INFO(<span class="stringliteral">&quot;Switch/Rollback succeeded&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Start the host SW upgrade if required, then system reset is required (Reinitialize the driver)</span></div>
<div class="line"> </div>
<div class="line">            WINC_LOG_INFO(<span class="stringliteral">&quot;Now resetting the system...&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> wifi_event_cb(uint8_t u8WiFiEvent, <span class="keyword">const</span> <span class="keywordtype">void</span> *<span class="keyword">const</span> pvMsg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="group___w_l_a_n_enums.html#gga064de09dec1d5e88ed8d075fa40f57deaa849449fa83e4b552689266a1f1019e7">M2M_WIFI_REQ_DHCP_CONF</a>:</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// After successful connection, start the OTA upgrade</span></div>
<div class="line">        <a class="code" href="group___w_i_n_c_o_t_a.html#gaefb92e6e53637bd62b8371e7f00dd4eb">m2m_ota_start_update</a>(OTA_URL);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="structtstr_wifi_init_param.html">tstrWifiInitParam</a>     param;</div>
<div class="line">    int8_t                s8Ret             = M2M_SUCCESS;</div>
<div class="line">    <span class="keywordtype">bool</span>                  rollback_required = <span class="keyword">false</span>;</div>
<div class="line">    <a class="code" href="structtstr1x_auth_credentials.html">tstr1xAuthCredentials</a> gstrCred1x        = AUTH_CREDENTIALS;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// System init, etc should be here...</span></div>
<div class="line"> </div>
<div class="line">    memset(&amp;param, 0, <span class="keyword">sizeof</span>(param));</div>
<div class="line">    param.<a class="code" href="group__m2m__wifi.html#ga26c229a7bbf756c2192c64fac8104af4">pfAppWifiCb</a> = wifi_event_cb;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize the WINC Driver</span></div>
<div class="line">    s8Ret = <a class="code" href="group___w_l_a_n_i_n_i_t.html#ga66f5bf5f84f898bdd4453f2717a3deb5">m2m_wifi_init</a>(&amp;param);</div>
<div class="line">    <span class="keywordflow">if</span>(s8Ret == M2M_ERR_FW_VER_MISMATCH)</div>
<div class="line">    {</div>
<div class="line">        WINC_LOG_ERROR(<span class="stringliteral">&quot;Firmware version mismatch&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (M2M_SUCCESS != s8Ret)</div>
<div class="line">    {</div>
<div class="line">        WINC_LOG_ERROR(<span class="stringliteral">&quot;Driver Init Failed &lt;%d&gt;&quot;</span>, s8Ret);</div>
<div class="line">        <span class="keywordflow">while</span>(1);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// Initialize the OTA module</span></div>
<div class="line">    <a class="code" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39">m2m_ota_init</a>(OtaUpdateCb, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Connect to AP that provides connection to the OTA server</span></div>
<div class="line">    <a class="code" href="group___w_l_a_n_c_o_n_n_e_c_t.html#ga739abd39f7befa0da7bcea564a726141">m2m_wifi_default_connect</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span>(1)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Handle the app state machine plus the WINC event handler</span></div>
<div class="line">        <span class="keywordflow">while</span>(<a class="code" href="group___w_l_a_n_e_v_t_s.html#gae397199d8523f172b33309b82c34c2af">m2m_wifi_handle_events</a>(NULL) != M2M_SUCCESS) {</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga24e44fbce7ca42ded0e1daa500c40ca8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga24e44fbce7ca42ded0e1daa500c40ca8">&#9670;&nbsp;</a></span>m2m_ota_switch_firmware()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t m2m_ota_switch_firmware </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Switch to the upgraded Firmware. </p>
<p>Request switch to the updated WINC image. The WINC firmware will check the validity of the inactive image and activate it if valid. On completion, a callback of type <a class="el" href="group___o_t_a_c_a_l_l_b_a_c_k_s.html#ga320069e48ae34c5bfd5ef5aebaf0269b">tpfOtaUpdateCb</a> is called (application must previously have provided the callback via <a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39">m2m_ota_init</a>). If the callback indicates successful activation, the newly-activated image will start running after next system reset.</p>
<dl class="section return"><dt>Returns</dt><dd>The function SHALL return 0 for success and a negative value otherwise.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>If switch requires a host driver update in order to maintain HIF compatibility (HIF major value change), then it is recommended to update the host driver prior to calling this API.<br  />
 In the event of system reset with incompatible driver/firmware, compatibility can be recovered by calling <a class="el" href="group___w_i_n_c_o_t_a.html#gad238a0b0d9218b8db10d82a95fc91dad">m2m_ota_rollback</a> or <a class="el" href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a>. See <a class="el" href="group___w_i_n_c_o_t_a.html#OTAExample">Example</a>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39" title="Initialize the OTA layer.">m2m_ota_init</a> <a class="el" href="group___w_i_n_c_o_t_a.html#gaefb92e6e53637bd62b8371e7f00dd4eb" title="Request OTA start update using the downloaded url.">m2m_ota_start_update</a></dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns M2M_SUCCESS for successful operations and a negative value otherwise. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="agroup___w_i_n_c_o_t_a_html_gaefb92e6e53637bd62b8371e7f00dd4eb"><div class="ttname"><a href="group___w_i_n_c_o_t_a.html#gaefb92e6e53637bd62b8371e7f00dd4eb">m2m_ota_start_update</a></div><div class="ttdeci">int8_t m2m_ota_start_update(unsigned char *pcDownloadUrl)</div><div class="ttdoc">Request OTA start update using the downloaded url.</div><div class="ttdef"><b>Definition:</b> m2m_ota.c:272</div></div>
<div class="ttc" id="agroup___w_l_a_n_enums_html_gga064de09dec1d5e88ed8d075fa40f57deaa849449fa83e4b552689266a1f1019e7"><div class="ttname"><a href="group___w_l_a_n_enums.html#gga064de09dec1d5e88ed8d075fa40f57deaa849449fa83e4b552689266a1f1019e7">M2M_WIFI_REQ_DHCP_CONF</a></div><div class="ttdeci">@ M2M_WIFI_REQ_DHCP_CONF</div><div class="ttdef"><b>Definition:</b> m2m_types.h:805</div></div>
<div class="ttc" id="agroup__m2m__wifi_html_ga26c229a7bbf756c2192c64fac8104af4"><div class="ttname"><a href="group__m2m__wifi.html#ga26c229a7bbf756c2192c64fac8104af4">tstrWifiInitParam::pfAppWifiCb</a></div><div class="ttdeci">tpfAppWifiCb pfAppWifiCb</div><div class="ttdef"><b>Definition:</b> m2m_wifi.h:311</div></div>
<div class="ttc" id="agroup___o_t_a_t_y_p_e_d_e_f_html_gga3e56744d263918b9e36016f78d823c3aa9b634fb58a53969f9af8a89908e58c5e"><div class="ttname"><a href="group___o_t_a_t_y_p_e_d_e_f.html#gga3e56744d263918b9e36016f78d823c3aa9b634fb58a53969f9af8a89908e58c5e">DL_STATUS</a></div><div class="ttdeci">@ DL_STATUS</div><div class="ttdef"><b>Definition:</b> m2m_types.h:2560</div></div>
<div class="ttc" id="agroup___w_l_a_n_e_v_t_s_html_gae397199d8523f172b33309b82c34c2af"><div class="ttname"><a href="group___w_l_a_n_e_v_t_s.html#gae397199d8523f172b33309b82c34c2af">m2m_wifi_handle_events</a></div><div class="ttdeci">int8_t m2m_wifi_handle_events(void *pVArg)</div><div class="ttdoc">Synchronous M2M event handler function.</div><div class="ttdef"><b>Definition:</b> m2m_wifi.c:497</div></div>
<div class="ttc" id="agroup___o_t_a_t_y_p_e_d_e_f_html_ggab7006b9cb55eb414d0416d0513533eeba23e293bcc679d3021e202ac255b71500"><div class="ttname"><a href="group___o_t_a_t_y_p_e_d_e_f.html#ggab7006b9cb55eb414d0416d0513533eeba23e293bcc679d3021e202ac255b71500">OTA_STATUS_SUCCESS</a></div><div class="ttdeci">@ OTA_STATUS_SUCCESS</div><div class="ttdef"><b>Definition:</b> m2m_types.h:2528</div></div>
<div class="ttc" id="agroup___o_t_a_t_y_p_e_d_e_f_html_gga3e56744d263918b9e36016f78d823c3aad9b2f16f8c41c4108806a4c78dea422c"><div class="ttname"><a href="group___o_t_a_t_y_p_e_d_e_f.html#gga3e56744d263918b9e36016f78d823c3aad9b2f16f8c41c4108806a4c78dea422c">RB_STATUS</a></div><div class="ttdeci">@ RB_STATUS</div><div class="ttdef"><b>Definition:</b> m2m_types.h:2564</div></div>
<div class="ttc" id="agroup___o_t_a_c_o_m_m_o_n_html_ga87960f1beeaec73ede1283ae058bfa39"><div class="ttname"><a href="group___o_t_a_c_o_m_m_o_n.html#ga87960f1beeaec73ede1283ae058bfa39">m2m_ota_init</a></div><div class="ttdeci">int8_t m2m_ota_init(tpfOtaUpdateCb pfOtaUpdateCb, tpfOtaNotifCb pfOtaNotifCb)</div><div class="ttdoc">Initialize the OTA layer.</div><div class="ttdef"><b>Definition:</b> m2m_ota.c:187</div></div>
<div class="ttc" id="agroup___w_l_a_n_c_o_n_n_e_c_t_html_ga739abd39f7befa0da7bcea564a726141"><div class="ttname"><a href="group___w_l_a_n_c_o_n_n_e_c_t.html#ga739abd39f7befa0da7bcea564a726141">m2m_wifi_default_connect</a></div><div class="ttdeci">int8_t m2m_wifi_default_connect(void)</div><div class="ttdoc">Asynchronous API that attempts to reconnect to the last-associated access point.</div><div class="ttdef"><b>Definition:</b> m2m_wifi.c:515</div></div>
<div class="ttc" id="astructtstr1x_auth_credentials_html"><div class="ttname"><a href="structtstr1x_auth_credentials.html">tstr1xAuthCredentials</a></div><div class="ttdef"><b>Definition:</b> m2m_wifi.h:338</div></div>
<div class="ttc" id="agroup___o_t_a_t_y_p_e_d_e_f_html_gga3e56744d263918b9e36016f78d823c3aa2f1dabb326d861eadb5a5cd1b41962ff"><div class="ttname"><a href="group___o_t_a_t_y_p_e_d_e_f.html#gga3e56744d263918b9e36016f78d823c3aa2f1dabb326d861eadb5a5cd1b41962ff">SW_STATUS</a></div><div class="ttdeci">@ SW_STATUS</div><div class="ttdef"><b>Definition:</b> m2m_types.h:2562</div></div>
<div class="ttc" id="agroup___w_i_n_c_o_t_a_html_ga24e44fbce7ca42ded0e1daa500c40ca8"><div class="ttname"><a href="group___w_i_n_c_o_t_a.html#ga24e44fbce7ca42ded0e1daa500c40ca8">m2m_ota_switch_firmware</a></div><div class="ttdeci">int8_t m2m_ota_switch_firmware(void)</div><div class="ttdoc">Switch to the upgraded Firmware.</div><div class="ttdef"><b>Definition:</b> m2m_ota.c:328</div></div>
<div class="ttc" id="astructtstr_wifi_init_param_html"><div class="ttname"><a href="structtstr_wifi_init_param.html">tstrWifiInitParam</a></div><div class="ttdoc">Structure, holding the Wi-fi configuration attributes such as the Wi-Fi callback ,...</div><div class="ttdef"><b>Definition:</b> m2m_wifi.h:310</div></div>
<div class="ttc" id="agroup___w_l_a_n_i_n_i_t_html_ga66f5bf5f84f898bdd4453f2717a3deb5"><div class="ttname"><a href="group___w_l_a_n_i_n_i_t.html#ga66f5bf5f84f898bdd4453f2717a3deb5">m2m_wifi_init</a></div><div class="ttdeci">int8_t m2m_wifi_init(tstrWifiInitParam *pWifiInitParam)</div><div class="ttdoc">Synchronous API to initialize the WINC driver.</div><div class="ttdef"><b>Definition:</b> m2m_wifi.c:473</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
